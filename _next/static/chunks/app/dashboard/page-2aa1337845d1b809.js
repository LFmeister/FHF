(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{1981:function(e,r,s){"use strict";s.d(r,{Z:function(){return t}});var a=s(2898);let t=(0,a.Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},8203:function(e,r,s){"use strict";s.d(r,{Z:function(){return t}});var a=s(2898);let t=(0,a.Z)("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]])},3008:function(e,r,s){"use strict";s.d(r,{Z:function(){return t}});var a=s(2898);let t=(0,a.Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},9883:function(e,r,s){"use strict";s.d(r,{Z:function(){return t}});var a=s(2898);let t=(0,a.Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},9409:function(e,r,s){"use strict";s.d(r,{Z:function(){return t}});var a=s(2898);let t=(0,a.Z)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},5750:function(e,r,s){"use strict";s.d(r,{Z:function(){return t}});var a=s(2898);let t=(0,a.Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},1783:function(e,r,s){Promise.resolve().then(s.bind(s,4909))},4909:function(e,r,s){"use strict";s.r(r),s.d(r,{default:function(){return DashboardPage}});var a=s(7437),t=s(2265),i=s(9883),l=s(5750),c=s(2898);let n=(0,c.Z)("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);var d=s(6806),o=s(4033),m=s(1865),x=s(8110),h=s(9310),u=s(1018),y=s(5270),p=s(47);function CreateProjectForm(e){var r,s;let{onSuccess:i}=e,[l,c]=(0,t.useState)(!1),[n,j]=(0,t.useState)(""),f=(0,o.useRouter)(),{register:v,handleSubmit:g,formState:{errors:b},reset:N}=(0,m.cI)({resolver:(0,x.F)(y.UA),defaultValues:{currency:"COP"}}),onSubmit=async e=>{try{c(!0),j("");let r=await p.C.createProject(e);N(),null==i||i(),f.push("/dashboard/project?id=".concat(r.id))}catch(e){j(e instanceof Error?e.message:"Error al crear el proyecto")}finally{c(!1)}};return(0,a.jsxs)(u.Zb,{className:"bg-white shadow-xl border-0",children:[(0,a.jsxs)(u.Ol,{className:"bg-gradient-to-r from-primary-600 to-primary-700 text-white rounded-t-lg",children:[(0,a.jsx)(u.ll,{className:"text-xl",children:"Crear Nuevo Proyecto"}),(0,a.jsx)(u.SZ,{className:"text-primary-100",children:"Crea un proyecto para gestionar balances y gastos colaborativamente"})]}),(0,a.jsx)(u.aY,{className:"p-6",children:(0,a.jsxs)("form",{onSubmit:g(onSubmit),className:"space-y-6",children:[n&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,a.jsx)("p",{className:"text-sm text-red-600",children:n})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"name",className:"block text-sm font-semibold text-primary-800 mb-2",children:"Nombre del Proyecto"}),(0,a.jsx)(h.I,{id:"name",type:"text",...v("name"),error:null===(r=b.name)||void 0===r?void 0:r.message,placeholder:"Ej: Viaje a Europa 2024",className:"border-primary-200 focus:border-primary-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"description",className:"block text-sm font-semibold text-primary-800 mb-2",children:"Descripci\xf3n (Opcional)"}),(0,a.jsx)(h.I,{id:"description",type:"text",...v("description"),error:null===(s=b.description)||void 0===s?void 0:s.message,placeholder:"Descripci\xf3n del proyecto...",className:"border-primary-200 focus:border-primary-500"})]}),(0,a.jsx)("div",{className:"bg-primary-50 p-4 rounded-lg border border-primary-200",children:(0,a.jsxs)("p",{className:"text-sm text-primary-700",children:[(0,a.jsx)("strong",{children:"Moneda:"})," Peso Colombiano (COP) por defecto. Podr\xe1s cambiar a D\xf3lar Australiano (AUD) desde la configuraci\xf3n del proyecto."]})}),(0,a.jsx)(d.z,{type:"submit",loading:l,className:"w-full",size:"lg",children:"Crear Proyecto"})]})})]})}let j=(0,c.Z)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);function JoinProjectForm(e){var r;let{onSuccess:s}=e,[i,l]=(0,t.useState)(!1),[c,n]=(0,t.useState)(null),f=(0,o.useRouter)(),{register:v,handleSubmit:g,formState:{errors:b},reset:N}=(0,m.cI)({resolver:(0,x.F)(y.mw)}),onSubmit=async e=>{l(!0),n(null);try{let r=await p.C.joinProject(e.inviteCode.toUpperCase());N(),null==s||s(),f.push("/dashboard/project?id=".concat(r.id))}catch(e){n(e.message||"Error al unirse al proyecto")}finally{l(!1)}};return(0,a.jsxs)(u.Zb,{children:[(0,a.jsxs)(u.Ol,{children:[(0,a.jsxs)(u.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(j,{className:"h-5 w-5"}),"Unirse a Proyecto"]}),(0,a.jsx)(u.SZ,{children:"Ingresa el c\xf3digo de invitaci\xf3n para unirte a un proyecto existente"})]}),(0,a.jsx)(u.aY,{children:(0,a.jsxs)("form",{onSubmit:g(onSubmit),className:"space-y-4",children:[c&&(0,a.jsx)("div",{className:"p-3 text-sm text-destructive bg-destructive/10 border border-destructive/20 rounded-md",children:c}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{htmlFor:"inviteCode",className:"text-sm font-medium",children:"C\xf3digo de Invitaci\xf3n"}),(0,a.jsx)(h.I,{id:"inviteCode",placeholder:"ABC12345",className:"uppercase",maxLength:8,error:null===(r=b.inviteCode)||void 0===r?void 0:r.message,...v("inviteCode"),onChange:e=>{e.target.value=e.target.value.toUpperCase()}}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"El c\xf3digo debe tener 8 caracteres (letras y n\xfameros)"})]}),(0,a.jsx)(d.z,{type:"submit",className:"w-full",loading:i,children:"Unirse al Proyecto"})]})})]})}var f=s(1396),v=s.n(f),g=s(9409),b=s(8203);let N=(0,c.Z)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),w=(0,c.Z)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);function ProjectCard(e){let{project:r,currentUserId:s}=e,[i,c]=(0,t.useState)(!1),copyInviteCode=async()=>{try{await navigator.clipboard.writeText(r.invite_code),c(!0),setTimeout(()=>c(!1),2e3)}catch(e){console.error("Failed to copy invite code:",e)}},n="owner"===r.user_role;return(0,a.jsxs)(u.Zb,{className:"hover:shadow-md transition-shadow",children:[(0,a.jsx)(u.Ol,{children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(u.ll,{className:"text-lg",children:r.name}),r.description&&(0,a.jsx)(u.SZ,{className:"mt-1",children:r.description})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[n&&(0,a.jsx)("span",{className:"px-2 py-1 text-xs bg-primary/10 text-primary rounded-full",children:"Propietario"}),(0,a.jsx)(v(),{href:"/dashboard/project?id=".concat(r.id,"&tab=settings"),children:(0,a.jsx)(d.z,{variant:"ghost",size:"sm",children:(0,a.jsx)(g.Z,{className:"h-4 w-4"})})})]})]})}),(0,a.jsx)(u.aY,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(b.Z,{className:"h-4 w-4"}),(0,a.jsxs)("span",{children:["Creado: ",new Date(r.created_at).toLocaleDateString("es-ES")]})]})}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,a.jsx)(l.Z,{className:"h-4 w-4"}),(0,a.jsxs)("span",{children:["C\xf3digo: ",r.invite_code]})]}),(0,a.jsx)(d.z,{variant:"ghost",size:"sm",onClick:copyInviteCode,className:"h-8 w-8 p-0",children:i?(0,a.jsx)(N,{className:"h-4 w-4 text-green-600"}):(0,a.jsx)(w,{className:"h-4 w-4"})})]}),(0,a.jsx)("div",{className:"flex gap-2",children:(0,a.jsx)(v(),{href:"/dashboard/project?id=".concat(r.id),className:"flex-1",children:(0,a.jsx)(d.z,{className:"w-full",children:"Ver Proyecto"})})})]})})]})}var C=s(471),k=s(1295),P=s(1981),S=s(3008);let Z=(0,c.Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);function EmailConfirmationPending(e){let{email:r,onSignOut:s}=e,[i,l]=(0,t.useState)(!1),[c,n]=(0,t.useState)("idle"),[o,m]=(0,t.useState)(""),handleResendConfirmation=async()=>{l(!0),n("idle");try{let{error:e}=await C.I.resendConfirmation(r);e?(n("error"),m(e.message||"Error al reenviar el correo de confirmaci\xf3n")):(n("success"),m("Correo de confirmaci\xf3n reenviado exitosamente"))}catch(e){n("error"),m("Error inesperado al reenviar el correo")}finally{l(!1)}};return(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 to-accent-50 flex items-center justify-center p-4",children:(0,a.jsxs)(u.Zb,{className:"w-full max-w-md shadow-xl border-0",children:[(0,a.jsxs)(u.Ol,{className:"text-center pb-4",children:[(0,a.jsx)("div",{className:"mx-auto mb-4",children:(0,a.jsx)("div",{className:"w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center",children:(0,a.jsx)(k.Z,{className:"h-8 w-8 text-yellow-600"})})}),(0,a.jsx)(u.ll,{className:"text-xl text-primary-800",children:"Confirma tu correo electr\xf3nico"}),(0,a.jsx)(u.SZ,{className:"text-primary-600",children:"Te hemos enviado un enlace de confirmaci\xf3n"})]}),(0,a.jsx)(u.aY,{className:"space-y-6",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)(P.Z,{className:"h-5 w-5 text-yellow-600 mt-0.5 flex-shrink-0"}),(0,a.jsxs)("div",{className:"text-left",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-yellow-800 mb-1",children:"Verificaci\xf3n requerida"}),(0,a.jsx)("p",{className:"text-sm text-yellow-700",children:"Hemos enviado un enlace de confirmaci\xf3n a:"}),(0,a.jsx)("p",{className:"text-sm font-medium text-yellow-800 mt-1",children:r})]})]})}),(0,a.jsxs)("div",{className:"text-sm text-gray-600 space-y-2 mb-6",children:[(0,a.jsx)("p",{children:"Para acceder a tu cuenta, debes:"}),(0,a.jsxs)("ol",{className:"text-left space-y-1 ml-4",children:[(0,a.jsx)("li",{children:"1. Revisar tu bandeja de entrada"}),(0,a.jsx)("li",{children:"2. Hacer clic en el enlace de confirmaci\xf3n"}),(0,a.jsx)("li",{children:"3. Regresar aqu\xed para iniciar sesi\xf3n"})]})]}),"success"===c&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-green-700 bg-green-50 p-3 rounded-lg mb-4",children:[(0,a.jsx)(S.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:o})]}),"error"===c&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-red-700 bg-red-50 p-3 rounded-lg mb-4",children:[(0,a.jsx)(P.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:o})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)(d.z,{onClick:handleResendConfirmation,disabled:i,loading:i,variant:"outline",className:"w-full",children:[(0,a.jsx)(Z,{className:"h-4 w-4 mr-2"}),i?"Reenviando...":"Reenviar correo de confirmaci\xf3n"]}),(0,a.jsxs)("div",{className:"text-center pt-4 border-t border-gray-100",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:"\xbfNo encuentras el correo? Revisa tu carpeta de spam."}),(0,a.jsx)(d.z,{onClick:s,variant:"ghost",className:"text-sm",children:"Cerrar sesi\xf3n y usar otra cuenta"})]})]})]})})]})})}function AuthGuard(e){let{children:r,requireEmailConfirmation:s=!0}=e,[i,l]=(0,t.useState)(!0),[c,n]=(0,t.useState)(null),[d,m]=(0,t.useState)(!1),x=(0,o.useRouter)();(0,t.useEffect)(()=>{let checkAuth=async()=>{try{let{user:e,error:r}=await C.I.getCurrentUser();if(r||!e){x.push("/auth/login");return}if(n(e),s){let e=await C.I.isEmailConfirmed();if(m(e),!e){l(!1);return}}l(!1)}catch(e){console.error("Error checking auth:",e),x.push("/auth/login")}};checkAuth();let{data:{subscription:e}}=C.I.onAuthStateChange((e,r)=>{"SIGNED_OUT"===e?x.push("/auth/login"):"SIGNED_IN"===e&&(null==r?void 0:r.user)&&(n(r.user),s&&C.I.isEmailConfirmed().then(m))});return()=>{e.unsubscribe()}},[x,s]);let handleSignOut=async()=>{await C.I.signOut(),x.push("/auth/login")};return i?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 to-accent-50 flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary-600"})}):s&&c&&!d?(0,a.jsx)(EmailConfirmationPending,{email:c.email,onSignOut:handleSignOut}):(0,a.jsx)(a.Fragment,{children:r})}function DashboardPage(){let[e,r]=(0,t.useState)([]),[s,c]=(0,t.useState)(null),[o,m]=(0,t.useState)(!0),[x,h]=(0,t.useState)(!1),[u,y]=(0,t.useState)(!1);(0,t.useEffect)(()=>{let loadData=async()=>{try{let{user:e}=await C.I.getCurrentUser();c(e);let s=await p.C.getUserProjects();r(s)}catch(e){console.error("Error loading data:",e)}finally{m(!1)}};loadData()},[]);let handleProjectCreated=async()=>{try{let e=await p.C.getUserProjects();r(e),h(!1)}catch(e){console.error("Error reloading projects:",e)}},handleProjectJoined=async()=>{try{let e=await p.C.getUserProjects();r(e),y(!1)}catch(e){console.error("Error reloading projects:",e)}};return o?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary-200 border-t-primary-600"})}):(0,a.jsx)(AuthGuard,{requireEmailConfirmation:!0,children:(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsx)("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:(0,a.jsxs)("div",{className:"sm:flex sm:items-center sm:justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-primary-800",children:"Dashboard"}),(0,a.jsx)("p",{className:"mt-2 text-primary-600",children:"Gestiona tus proyectos de contabilidad colaborativa"})]}),(0,a.jsxs)("div",{className:"mt-4 sm:mt-0 sm:flex sm:space-x-3",children:[(0,a.jsxs)(d.z,{onClick:()=>h(!x),variant:x?"secondary":"primary",size:"lg",children:[(0,a.jsx)(i.Z,{className:"h-5 w-5 mr-2"}),x?"Cancelar":"Crear Proyecto"]}),(0,a.jsxs)(d.z,{onClick:()=>y(!u),variant:u?"secondary":"outline",size:"lg",children:[(0,a.jsx)(l.Z,{className:"h-5 w-5 mr-2"}),u?"Cancelar":"Unirse a Proyecto"]})]})]})}),(0,a.jsxs)("div",{className:"space-y-6",children:[x&&(0,a.jsx)(CreateProjectForm,{onSuccess:handleProjectCreated}),u&&(0,a.jsx)(JoinProjectForm,{onSuccess:handleProjectJoined})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold text-primary-800 mb-2",children:["Mis Proyectos (",e.length,")"]}),(0,a.jsx)("div",{className:"h-1 w-20 bg-gradient-to-r from-primary-600 to-primary-400 rounded-full"})]}),o?(0,a.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary-200 border-t-primary-600"})}):0===e.length?(0,a.jsxs)("div",{className:"text-center py-16 bg-white rounded-2xl shadow-lg border border-primary-100",children:[(0,a.jsx)(n,{className:"mx-auto h-16 w-16 text-primary-300"}),(0,a.jsx)("h3",{className:"mt-4 text-lg font-semibold text-primary-800",children:"No hay proyectos"}),(0,a.jsx)("p",{className:"mt-2 text-primary-600 max-w-sm mx-auto",children:"Comienza creando un nuevo proyecto o \xfanete a uno existente usando un c\xf3digo de invitaci\xf3n."}),(0,a.jsxs)("div",{className:"mt-6 flex justify-center space-x-3",children:[(0,a.jsxs)(d.z,{onClick:()=>h(!0),size:"lg",children:[(0,a.jsx)(i.Z,{className:"h-5 w-5 mr-2"}),"Crear Proyecto"]}),(0,a.jsxs)(d.z,{onClick:()=>y(!0),variant:"outline",size:"lg",children:[(0,a.jsx)(l.Z,{className:"h-5 w-5 mr-2"}),"Unirse a Proyecto"]})]})]}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:e.map(e=>(0,a.jsx)(ProjectCard,{project:e,currentUserId:(null==s?void 0:s.id)||""},e.id))})]})]})})}},4033:function(e,r,s){e.exports=s(94)}},function(e){e.O(0,[218,727,473,20,971,472,744],function(){return e(e.s=1783)}),_N_E=e.O()}]);